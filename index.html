<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>北京治安地图</title>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="format-detection" content="telephone=no"><!-- 取消格式监察 -->
    <meta name="format-detection" content="email=no">
    <meta name="apple-mobile-web-app-capable" content="yes"><!-- 删除默认的苹果工具栏和菜单栏 -->
    <meta name="apple-mobile-web-app-atatus-bar-style" content="black"><!-- 控制状态栏显示样式 -->
    <meta name="author" content="镝次元实验室（前端by黎晓媚、吴飞黄、刘佳派）">
    <link rel="stylesheet" type="text/css" href="css/animate.min.css"/>
    <link rel="stylesheet" type="text/css" href="css/swiper-3.3.1.min.css"/>
    <!--标准mui.css-->
    <link rel="stylesheet" href="css/mui.min.css">
    <link href="css/mui.picker.css" rel="stylesheet"/>
    <link href="css/mui.poppicker.css" rel="stylesheet"/>
    <!-- 自定义 -->
    <link rel="stylesheet" type="text/css" href="css/style.css"/>

</head>
<body scroll="no">
<div class="swiper-container">
    <div id="wrapper" class="swiper-wrapper">
        <div class="swiper-slide page1">
            <div class="container">
                <div class="img start_jing ani" swiper-animate-effect="fadeIn" swiper-animate-duration="0.5s"
                     swiper-animate-delay=".3s"></div>
                <div class="img start_10 ani" swiper-animate-effect="fadeIn" swiper-animate-duration="0.3s"
                     swiper-animate-delay=".8s"></div>
                <div class="img start_title ani" swiper-animate-effect="fadeIn" swiper-animate-duration="0.5s"
                     swiper-animate-delay="1.1s"></div>
                <div class="img start_subtitle ani" swiper-animate-effect="fadeIn" swiper-animate-duration="0.5s"
                     swiper-animate-delay="1.6s"></div>
                <div class="img start_car1 ani" swiper-animate-effect="carmove1" swiper-animate-duration="2s"
                     swiper-animate-delay="1.2s"></div>
                <div class="img start_car2 ani" swiper-animate-effect="carmove2" swiper-animate-duration="2s"
                     swiper-animate-delay="1s"></div>
                <div class="img start_car3 ani" swiper-animate-effect="carmove3" swiper-animate-duration="2s"
                     swiper-animate-delay="1.4s"></div>
                <div class="img start_next ani" swiper-animate-effect="fadeIn" swiper-animate-duration=".3s"
                     swiper-animate-delay="2.6s"></div>
            </div>
        </div>
        <div class="swiper-slide page2 swiper-no-swiping">
            <div class="container">
                <iframe id="iframe" name="map"
                        src="http://www.dyclub.org/projects/pekingSecurity/map/map.html"></iframe>
                <div id="introduction">
                    <div class="box">
                        <div class="introText">
                            <p class="first-para">您现在看到的是2014-2015年，北京12个区县，因治安案件被北京市公安局“一周治安播报”点名的情况。您是否会好奇：</p>
                            <!-- <br> -->
                            <p>小偷是否也和您一样正常“上下班”？</p>
                            <p>骗子喜欢在什么时候给您下套？</p>
                            <p>汽车撬砸案件在哪里频发？</p>
                            <p>抢劫、抢夺事件最常出现的地点是何处？</p>
                            <!-- <br> -->
                            <p class="last-para">欲知详情，点击<img
                                    src="http://static.dyclub.org/img/2016/05/pekingSecurity/closeBtn.png">继续查看</p>
                        </div>
                    </div>
                    <img class="closeBtn" src="http://static.dyclub.org/img/2016/05/pekingSecurity/closeBtn.png">
                </div>

                <div id="operateArea">
                    <ul id="mainBtns">
                        <li id="caseTypeBtn" class="active"><span>案件类型</span></li>
                        <li id="caseTimeBtn"><span>案发时间</span></li>
                        <li id="caseAreaBtn"><span>案发区域</span></li>
                    </ul>
                    <img src="http://static.dyclub.org/img/2016/05/pekingSecurity/blueNextArrow_03.png"
                         class="nextPageBtn twinkling">

                    <ul id="caseTypes">
                        <li data-class="zong" data-type="" class="active">总</li>
                        <li data-class="ru" data-type="入室盗窃">入</li>
                        <li data-class="qiao" data-type="撬砸汽车">撬</li>
                        <li data-class="pa" data-type="扒窃">扒</li>
                        <li data-class="qiang" data-type="抢劫/抢夺">抢</li>
                        <li data-class="ling" data-type="拎包盗窃">拎</li>
                        <li data-class="pian" data-type="诈骗">骗</li>
                        <li data-class="che" data-type="盗窃机动车">车</li>
                        <li data-class="fei" data-type="盗窃非机动车">非</li>
                    </ul>
                </div>

                <div id="legend">
                    <span id="icon" class="zong"></span><span class="caseTime">2014-2015年</span><span class="caseType">总体图</span>
                </div>

                <div class="region-pop swiper-no-swiping">
                    <div class="region-pop-header">
                        选择您想了解的区域
                    </div>
                    <div class="region-pop-body">
                        <div class="region-item" data-id="0">朝阳区</div>
                        <div class="region-item" data-id="1">丰台区</div>
                        <div class="region-item" data-id="2">海淀区</div>
                        <div class="region-item" data-id="3">西城区</div>
                        <div class="region-item" data-id="4">石景山区</div>
                        <div class="region-item" data-id="5">东城区</div>
                        <div class="region-item" data-id="6">昌平区</div>
                        <div class="region-item" data-id="7">大兴区</div>
                        <div class="region-item" data-id="8">密云区</div>
                        <div class="region-item" data-id="9">平谷区</div>
                        <div class="region-item" data-id="10">怀柔区</div>
                        <div class="region-item" data-id="11">通州区</div>
                        <div class="region-item region-item-disable" data-id="12">顺义区</div>
                        <div class="region-item region-item-disable" data-id="13">延庆县</div>
                        <div class="region-item region-item-disable" data-id="14">门头沟区</div>
                        <div class="region-item region-item-disable" data-id="15">房山区</div>
                    </div>
                </div>
                <div class="region-detail">
                    <div class="table-container">
                        <table class="region-table">
                            <tr class="table-header">
                                <td class="region-name table-left">朝阳区</td>
                                <td class="named-titles">2014年-2015年<br>被点名次数</td>
                                <td class="named-times"></td>
                            </tr>
                            <tr class="rank">
                                <td class="table-left">
                                    在北京所有区县中排
                                </td>
                                <td class="table-right" colspan="2">
                                    第<span class="rank-number">1</span>位
                                </td>
                            </tr>
                            <tr class="most-named-street">
                                <td class="table-left">
                                    被点名最多的街道
                                </td>
                                <td class="table-right" colspan="2">
                                    XXX
                                </td>
                            </tr>
                            <tr class="most-happen">
                                <td class="table-left">
                                    被点名案件最多发生在
                                </td>
                                <td class="table-right" colspan="2">
                                    XXX
                                </td>
                            </tr>
                            <tr class="graph-th">
                                <td id="graph-container" colspan="3">
                                    <div id="graph">

                                    </div>
                                </td>
                            </tr>
                            <tr class="changed-title">
                                <td colspan="3">
                                    <div class="row-container">
                                        <div class="cause-type">案件类型</div>
                                        <div class="clicked-times">被点名次数</div>
                                        <div class="rate-whole-city">在全市占比</div>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                    <div id="show-others">查看其它区域</div>
                </div>


            </div>
        </div>
        <div class="swiper-slide page3">
            <div class="container">
                <div class="img end_1 ani" swiper-animate-effect="fadeIn" swiper-animate-duration="0.5s" swiper-animate-delay="0.3s"></div>
				<div class="img end_2 ani" swiper-animate-effect="fadeIn" swiper-animate-duration="0.5s" swiper-animate-delay="0.8s"></div>
				<div class="img end_3 ani" swiper-animate-effect="fadeIn" swiper-animate-duration="0.5s" swiper-animate-delay="1.3s">
                    <!-- 二维码被识别的方法 -->
                    <img src="img/end_3.png" alt="扫描二维码" />  
                </div>
				<div class="img end_4 ani" swiper-animate-effect="fadeIn" swiper-animate-duration="0.5s" swiper-animate-delay="1.8s"></div>
            </div>
        </div>
    </div>

</div>


<script type="text/javascript" src="js/jquery-1.12.3.min.js"></script>
<script type="text/javascript" src="js/swiper-3.3.1.jquery.min.js"></script>
<script type="text/javascript" src="js/swiper.animate1.0.2.min.js"></script>
<script src="js/mui.min.js"></script>
<script src="js/mui.picker.js"></script>
<script src="js/mui.poppicker.js"></script>
<script src="http://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js"></script>
<script src="js/echarts.min.js"></script>
<!-- 自定义 -->
<script type="text/javascript" src="js/xiaomei.js"></script>

<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script type="text/javascript" src="http://static.dyclub.org/js/utils/share/share.js"></script>

<script type="text/javascript">
    $(function () {
        FastClick.attach(document.body);
    });

    var animationDiv = $(".start_next");
    animationDiv.bind("webkitAnimationEnd", function () {
        animationDiv.removeClass("ani");
        animationDiv.attr('style', '')
        animationDiv.addClass("twinkling");
    });


    (function (mui, doc) {
        mui.init();
        mui.ready(function () {
            //普通示例
            var userPicker = new mui.PopPicker();
            userPicker.setData([{value: '2014', text: '2014全年'},
                {value: '201401', text: '2014年1月'}, {value: '201402', text: '2014年2月'},
                {value: '201403', text: '2014年3月'}, {value: '201404', text: '2014年4月'},
                {value: '201405', text: '2014年5月'}, {value: '201406', text: '2014年6月'},
                {value: '201407', text: '2014年7月'}, {value: '201408', text: '2014年8月'},
                {value: '201409', text: '2014年9月'}, {value: '201410', text: '2014年10月'},
                {value: '201411', text: '2014年11月'}, {value: '201412', text: '2014年12月'},
                {value: '2015', text: '2015全年'},
                {value: '201501', text: '2015年1月'}, {value: '201502', text: '2015年2月'},
                {value: '201503', text: '2015年3月'}, {value: '201504', text: '2015年4月'},
                {value: '201505', text: '2015年5月'}, {value: '201506', text: '2015年6月'},
                {value: '201507', text: '2015年7月'}, {value: '201508', text: '2015年8月'},
                {value: '201509', text: '2015年9月'}, {value: '201510', text: '2015年10月'},
                {value: '201511', text: '2015年11月'}, {value: '201512', text: '2015年12月'},
                {value: '', text: '2014-2015两年'}
            ]);
            var showUserPickerButton = doc.getElementById('caseTimeBtn');
            showUserPickerButton.addEventListener('tap', function (event) {
                $('#mainBtns>li.active').removeClass('active');
                $('#caseTimeBtn').addClass('active');
                $('#caseTypes').hide();
                $('.region-pop').hide();
                $('#legend').show();

                userPicker.show(function (items) {
                    $('#legend>.caseTime').text(items[0].text);
                    map.window.geoq.setTime(items[0].value);
                });
            }, false);
        });
    })(mui, document);

    var geoqStarted = false;

    //swiper.js
    var mySwiper = new Swiper('.swiper-container', {
        direction: 'vertical',
        loop: false,

        // 如果需要前进后退按钮
        nextButton: '.swiper-button-next',
        onInit: function (swiper) { //Swiper2.x的初始化是onFirstInit
            swiperAnimateCache(swiper); //隐藏动画元素
            swiperAnimate(swiper); //初始化完成开始动画
        },
        onSlideChangeStart: function (swiper) {
            if (mySwiper.progress == 0.5) {
                if (!geoqStarted) {
                    map.window.geoq.start();
                    geoqStarted = true;
                }

            }
        },
        onSlideChangeEnd: function (swiper) {
            swiperAnimate(swiper); //每个slide切换结束时也运行当前slide动画
        }
    })

    // 样式调整
    // 设置介绍页内部box div的高，以设置边框外等距边距
    var introHeight = $('#introduction').height();
    $('#introduction>.box').height(introHeight - 5 * 2);


    function showIntro() {
        $('#introduction').fadeIn(500);
    }

    // 点击关闭按钮关闭浮层
    $('.closeBtn').click(function (e) {
        var target = $(e.target);
        target.parent().fadeOut();

        $('#operateArea').show();
        $('#legend').show();
        $('.page2').toggleClass('swiper-no-swiping');

    })

    // 主按钮，选择类型、时间或区域
    $('#mainBtns').click(function (e) {
        var target = $(e.target);
        $('#mainBtns>li.active').removeClass('active');
        target.addClass('active');
        target.parent().addClass('active');
    })
    $('#caseTypeBtn').click(function () {
        $('#legend').show();
        $('#caseTypes').show();
        $('.region-pop').hide();
    })
    $('#caseAreaBtn').click(function () {
        $('#legend').hide();
        $('#caseTypes').hide();
        $('.region-pop').toggle();
    })

    // 案件类型选择
    $('#caseTypes').click(function (e) {
        var target = $(e.target);
        $('#caseTypes>.active').removeClass('active');
        target.addClass('active');
        $('#legend>.caseType').text(function () {
            return target.data("type") ? target.data("type") : "总体图";
        });
        $('#icon').attr('class', target.data("class"));
        map.window.geoq.setType(target.data("type"));
    })


    var containerWidth = $(window).width() * 326 / 375;
    $("#graph").width(containerWidth);
    //echarts
    var myChart = echarts.init(document.getElementById('graph'));
    var chartOption = {
        title: {
            text: '各月点名次数分布',
            textStyle: {
                color: 'rgba(255,255,255,.7)',
                fontFamily: 'Microsoft Yahei UI',
                fontSize: '12'
            }
        },
        color: ['#d3d6dd'],
        textStyle: {
            color: ['#d3d6dd']
        },
        legend: {
            data: ['被点名次数'],
            textStyle: {
                color: 'rgba(255,255,255,.7)',
                fontFamily: 'Microsoft Yahei UI',
                fontSize: '12'
            },
            selectedMode: false,
            right: '2%'
        },
        grid: {
            show: false,
            top: "20%",
            width:"85%",
            borderColor: 'rgba(255,255,255,.7)'
        },
        xAxis: {
            type: 'category',
            splitLine: {show: false},
            axisLine: {
                show: true,
                lineStyle:{
                    color: 'rgba(255,255,255,.7)'
                }
            },
            axisLabel: {
                interval: 1,
                textStyle: {
                    color: 'rgba(255,255,255,.7)'
                }
            },
            data: [
                "1月", "2", "3\n\n2014年", "4", "5", "6", "7", "8", "9", "10", "11", "12", "1", "2", "3\n\n2015年", "4", "5", "6", "7", "8", "9", "10", "11", "12"]
        },
        yAxis: {
            type: 'value',
            splitLine: {
                show:false
            },
            axisLine: {
                show: true,
                lineStyle:{
                    color: 'rgba(255,255,255,.7)'
                }
            },
            axisTick:{
                show:true,
                lineStyle:{
                    color: 'rgba(255,255,255,.7)'
                }
            },
            axisLabel: {
                textStyle: {
                    color: 'rgba(255,255,255,.7)'
                }
            }
        },
        series: [{
            name: '被点名次数',
            type: 'bar',
            data: [5, 20, 36, 10, 10, 20, 5, 20, 36, 10, 10, 20, 5, 20, 36, 10, 10, 20, 5, 20, 36, 10, 10, 20]
        }]
    };
    $(document).ready(function () {
        $.getJSON("./data/data.json", function (dataObj) {
            $(".region-item:not(.region-item-disable)").click(function () {
                var regionId = $(this).data('id');
                $(".region-pop").css("display", "none");
                $(".region-detail").css({
                    "visibility": "visible",
                    "z-index": 99
                });
                $('#operateArea').hide();
                setTable(regionId, dataObj);
                $('.page2').toggleClass('swiper-no-swiping');
            });

            $(".region-item-disable").click(function () {
                alert('北京市公安局"一周治安播报"未公布该区县在2014-2015年的治安情况');
            });

            $("#show-others").click(function () {
                $(".region-pop").show();
                $(".region-detail").css({
                    "visibility": "hidden",
                    "z-index": -1
                });
                $('#operateArea').show();
                $(".changed-line").remove();

                $('.page2').toggleClass('swiper-no-swiping');
            });
        });
        var title = "北京治安地图：2014~2015年北京治安警情数据研究报告";
        var link = "http://www.dyclub.org/projects/pekingSecurity/";
        var img_url = "http://static.dyclub.org/img/2016/05/pekingSecurity/share_logo.jpg";
        var desc = "澎湃新闻、镝次元数据传媒实验室联合出品";
        share(img_url, link, title, desc);


        var _hmt = _hmt || [];
        (function () {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?de3d5156455b3fe29788e11500bdb3c1";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
        function setTable(regionId, dataObj) {
            var regionInfo = dataObj[regionId];
            $(".region-name").text(regionInfo.region);
            $(".rank-number").text(regionInfo.rank);
            $(".named-times").text(regionInfo.namedTimes);
            $(".most-named-street>.table-right").text(regionInfo.mostNamedStreet);
            $(".most-happen>.table-right").text(regionInfo.mostHappenTime);
            var graphArr = regionInfo.namedTimesDetail;
            chartOption.series[0].data = [];
            $(graphArr).each(function () {
                chartOption.series[0].data.push(this.namedTimes);
            });
            myChart.setOption(chartOption);
            var causeDetailArr = regionInfo.causeDetail;
            var causeDetailHtml = '';
            $(causeDetailArr).each(function () {
                var causeType = this.causeType;
                var namedTimes = this.namedTimes;
                var percent = this.percent;
                causeDetailHtml += '  <tr class="changed-line"> <td  colspan="3"> ' +
                        '<div class="row-container"> <div class="cause-type">' + causeType + '</div> ' +
                        '<div class="clicked-times">' + namedTimes + '</div> <div class="rate-whole-city">' + percent + '</div>' +
                        ' </div> </td> </tr>';
            });
            $(".region-table").append(causeDetailHtml);
        }
    });
</script>
</body>
</html>